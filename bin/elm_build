#!/usr/bin/env bash
set -eo pipefail

ELM_BINARIES=$BUILD_DIR/node_modules/elm/binwrappers
BUILD_IN=$BUILD_DIR/frontend/src/Main.elm
BUILD_OUT=$BUILD_DIR/testr/core/static/js/main.js

echo "-----> Installing Elm"
npm install elm
echo "-----> Installing Uglify"
npm install -g uglify-js
ln -s -f ../../vendor/node/bin/uglifyjs .heroku/python/bin/uglifyjs
echo "-----> Installing Elm packages"
$ELM_BINARIES/elm-package install -y
echo "-----> Building Elm application"
$ELM_BINARIES/elm-make $BUILD_IN --output $BUILD_OUT
echo "-----> Minifying build"
uglifyjs --compress --mangle -- $BUILD_OUT
